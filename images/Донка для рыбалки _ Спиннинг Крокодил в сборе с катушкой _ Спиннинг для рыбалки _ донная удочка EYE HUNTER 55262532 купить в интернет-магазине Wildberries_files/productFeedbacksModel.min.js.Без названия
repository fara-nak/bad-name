(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var FeedbacksCarousel=function(e){function t(o,r,i,a){var n;return(n=e.call(this)||this).imtId=o,n.votes=i,n.feedbacks=t.proceedFeedbacks(r,i),n.totalCount=a,n.hasMore=a>n.feedbacks.length,n}_inheritsLoose(t,e),t.proceedFeedbacks=function(e,o){return Array.isArray(e)?e.map(function(e){var r,i,a,n,s,d;return{id:e.id,userName:e.wbUserDetails.name,personalPhoto:$.views.helpers.PersonalPhoto(e.wbUserId,e.wbUserDetails.hasPhoto),userId:e.wbUserId,country:null!==(r=null===(i=e.wbUserDetails.country)||void 0===i?void 0:i.toLowerCase())&&void 0!==r?r:"",feedbackDate:new Date(e.createdDate).format("dd MMMM yyyy, HH:mm"),productValuation:e.productValuation,productSize:e.size,productSizeMatch:e.matchingSize&&t.proceedSizeValuation(e.matchingSize),productColor:e.color,text:e.text,photos:e.photos,votesUp:null!==(a=null===(n=e.votes)||void 0===n?void 0:n.pluses)&&void 0!==a?a:0,votesDown:null!==(s=null===(d=e.votes)||void 0===d?void 0:d.minuses)&&void 0!==s?s:0,voted:"plus"==o[e.id]?1:"minus"==o[e.id]?-1:null,star:e.productValuation}}):[]},t.proceedSizeValuation=function(e){switch(e){case"smaller":return WbSpaModel.prototype.$localziation.sizeMatchSmall;case"bigger":return WbSpaModel.prototype.$localziation.sizeMatchBig;default:return WbSpaModel.prototype.$localziation.sizeMatchOk}};var o=t.prototype;return o.leaveCommentComplaint=function(e){var t=$.view(e.currentTarget).data;t&&this.$moduleLoader.loadModuleAsync("feedbackComplaintPopup").then(function(e){e.showPopup(t.id)})},o.vote=function(e,t){var o=this,r=$.view(t.currentTarget).data;if(r&&!r.voted)return this.$analitic.sendEvent(e>0?"Item_Feedback_Like_T":"Item_Feedback_Dislike_T",{}),this.$httpClient.fetchJSON("/product/comments/vote",{method:"POST",body:new URLSearchParams({id:r.id,vote:e,link:this.imtId})},{redirectUnauth:!0}).then(function(){var t;$.observable(r).setProperty({voted:e>0?1:-1,votesUp:r.votesUp+(e>0?1:0),votesDown:r.votesDown+(e>0?0:1)}),o.votes[r.id]=e>0?"plus":"minus",null===(t=o.$services.productFeedbacksService)||void 0===t||t.dropFromCache(o.imtId)})},o.goToProfile=function(e){var t=this,o=$.view(e.currentTarget).data;if(o)return this.$analitic.sendEvent("Item_Feedback_Profile_T"),this.$httpClient.fetchJSON("/profile/spa/profile/url",{method:"POST",body:new URLSearchParams({userId:o.userId})}).then(function(e){return t.$router.moveTo(e.url)}),!1},o.showFeedbackPhotos=function(e){var t=$.view(e.currentTarget).data;if(t){var o=e.currentTarget.closest(".j-feedback-slide"),r=$.view(o).data;if(r){var i=r.photos.findIndex(function(e){return e==t});this.$moduleLoader.loadModuleAsync("photoGalleryViewer").then(function(e){var t=r.photos.map(function(e){return{preview:e.minSizeUri,fullPath:e.fullSizeUri}});(new e).showCompositeSwiper(t,i,!1,{classList:["goods-photo"]})})}}},t}(WbSpaModel);module.exports=FeedbacksCarousel;

},{}],2:[function(require,module,exports){
"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);s=!0);}catch(e){a=!0,o=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw o}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(){var e=require("./feedbacksCarousel"),t=function(){function t(t,r,n,o,i){this.parentId=t,this.nmId=r.nmId,this.imtId=r.imtId,this.chrtId=r.chrtId,this.productModel=r,this.feedbacksCarousel=new e(this.imtId,n.feedbacks,i.votes,n.summaryModel.totalCount),this.summaryModel=n.summaryModel,this.galleryModel=o,this.rawData=i,this.swiper=null,this.showCommentPopup=this.showCommentPopup.bind(this),this.allFeedbacksLink=this.allFeedbacksLink.bind(this),this.beforeAllFeedbacksTransition=this.beforeAllFeedbacksTransition.bind(this),this.onSizeUpdated=this.onSizeUpdated.bind(this),this.onColorChanged=this.onColorChanged.bind(this),this.onProductChanged=this.onProductChanged.bind(this),this.allFeedbacksLink.depends=["nmId","chrtId"]}var r=t.prototype;return r.init=function(){this.initCarousel(),this.galleryModel.initCarousel(),this._bindEvents()},r.destroy=function(){var e;null===(e=this.swiper)||void 0===e||e.destroy(),this._unbindEvents()},r.onSizeUpdated=function(e){var t=e.detail,r=t.nmId,n=t.selectedSize;this.nmId==r&&$.observable(this).setProperty({chrtId:n})},r.onColorChanged=function(e){var t,r=e.detail,n=r.sourceId,o=r.sourceNmId,i=r.selectedNomenclature;n==this.parentId&&o==this.nmId&&$.observable(this).setProperty({nmId:i.nmId,chrtId:null===(t=i.selectedSize)||void 0===t?void 0:t.characteristicId})},r.onProductChanged=function(e){var t=e.detail,r=t.sourceId,n=t.sourceNmId;r==this.parentId&&n==this.nmId&&this.destroy()},r.allFeedbacksLink=function(){return"/catalog/".concat(this.nmId,"/feedbacks?imtId=").concat(this.imtId).concat(this.chrtId?"&size=".concat(this.chrtId):"")},r.beforeAllFeedbacksTransition=function(){this.$services.productFeedbacksService.saveFeedbacksModelToCache(this.imtId,this.rawData)},r.initCarousel=function(){var e=document.querySelector(".j-feedbacks-swiper-carousel .swiper-container");e&&(this.swiper=new Swiper(e,{slidesPerView:"auto",watchOverflow:"true",spaceBetween:8,navigation:{nextEl:e.parentElement.querySelector(".swiper-button-next"),prevEl:e.parentElement.querySelector(".swiper-button-prev")},breakpoints:{1024:{spaceBetween:24}}}),this.$helper.nextTick().then(function(){e.querySelectorAll(".j-feedback-text").forEach(function(e){var t;e.scrollHeight>e.clientHeight&&(null===(t=e.querySelector(".j-show-more-btn"))||void 0===t||t.classList.remove("hide"))})}))},r.showSummaryPopup=function(){var e=this;Promise.all([this.$moduleLoader.loadModuleAsync("mobileSummaryPopup"),$.views.loadTemplateAsync("feedbacksValuationDistribution"),$.views.loadTemplateAsync("sizeMatchDistribution")]).then(function(t){_slicedToArray(t,1)[0].showPopup(e)})},r.showCommentPopup=function(){var e=this;Promise.all([this.$httpClient.fetchJSON("/product/comments/goods?nmId=".concat(this.nmId),{method:"POST"},{redirectUnauth:!0}),this.$moduleLoader.loadModuleAsync("feedbacksEditor"),this.$moduleLoader.loadModuleAsync("imageUploader")]).then(function(t){var r=_slicedToArray(t,3),n=r[0],o=r[1],i=r[2].ImageUploader;o.showFeedbacksPopup(e.imtId,e.productModel,n,new i(o.imageLoaderSettings))}).catch(function(t){if(!t.isUnauthorize)return t.isCustomError?wb.popup.renderModalError(t.message):void $.views.loadTemplateAsync("feedbacksubmiterror").then(function(e){if(!e)return Promise.reject();wb.popup.showCustomPopup({useHtml:!0,msg:e.render(),popupClassesList:["popup-alert","popup-error-feedbacks","shown"],contentClasses:["popup__content"],useCenteredFunction:!0,modal:!1})}).catch(function(t){wb.popup.renderModalError(e.$localziation.serverError)})})},r._bindEvents=function(){this.$eventBus.addEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.addEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.addEventListener("ProductChanged",this.onProductChanged)},r._unbindEvents=function(){this.$eventBus.removeEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.removeEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.removeEventListener("ProductChanged",this.onProductChanged)},_createClass(t,[{key:"template",get:function(){return t.template}},{key:"hasFeedbacks",get:function(){return this.feedbacksCarousel.feedbacks.length>0}}]),t}();window.__spaModuleManager__.register("productFeedbacksModel",t)}();

},{"./feedbacksCarousel":1}]},{},[2]);
